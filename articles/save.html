<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidypredict">
<title>Save and re-load models • tidypredict</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Save and re-load models">
<meta property="og:description" content="tidypredict">
<meta property="og:image" content="https://tidypredict.tidymodels.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="tidypredict.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidypredict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-model-list">Model list</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-model-list">
    <a class="dropdown-item" href="../articles/lm.html">Linear Regression - lm()</a>
    <a class="dropdown-item" href="../articles/glm.html">Generalized Regression - glm()</a>
    <a class="dropdown-item" href="../articles/ranger.html">Random Forest - Ranger - ranger()</a>
    <a class="dropdown-item" href="../articles/rf.html">Random Forest - randomForest()</a>
    <a class="dropdown-item" href="../articles/mars.html">MARS - earth()</a>
    <a class="dropdown-item" href="../articles/cubist.html">Cubist - cubist()</a>
    <a class="dropdown-item" href="../articles/xgboost.html">XGboost - xgb.Booster.complete()</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/save.html">Save/Reload</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/non-r.html">Non-R models</a>
    <a class="dropdown-item" href="../articles/regression.html">Regression spec</a>
    <a class="dropdown-item" href="../articles/tree.html">Tree model spec</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/sql.html">DB Writeback</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/tidypredict/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Save and re-load models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tidypredict/blob/HEAD/vignettes/save.Rmd" class="external-link"><code>vignettes/save.Rmd</code></a></small>
      <div class="d-none name"><code>save.Rmd</code></div>
    </div>

    
    
<p><code>tidypredict</code> splits the translation process in two. It
first parses the model to extract the needed components to produce the
prediction. And second, it uses the object with the parsed information
to produce the R formula. Thanks to this two step process,
<code>tidypredict</code> does not need to parse the model every time.
<code>tidypredict</code>’s functions also accept R objects that
contained already models that have been parsed already. Additionally,
because the parsed model object is made up of a list made up of basic
variables, it is possible to save it in a file. Currently, the best file
format is YAML.</p>
<p>For this article, we will use the following model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="op">(</span><span class="va">wt</span> <span class="op">+</span> <span class="va">disp</span><span class="op">)</span> <span class="op">*</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="parse-model">Parse model<a class="anchor" aria-label="anchor" href="#parse-model"></a>
</h2>
<p>The <code><a href="../reference/parse_model.html">parse_model()</a></code> function allows to run the first step
manually. It will return an R list object which contains all of the
needed information to produce a prediction calculation. The structure of
the parsed model varies based on what kind of model is being processed.
In general, it is consistent in what kind of information it expects from
each model type. For example, in the example the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> model
object will return variables such as <code>sigma2</code>, which would
not be used in other model types, such as decision trees.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidypredict.tidymodels.org">tidypredict</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_model.html">parse_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">parsed</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ general:List of 6</span></span>
<span><span class="co">#&gt;   ..$ model   : chr "lm"</span></span>
<span><span class="co">#&gt;   ..$ version : num 2</span></span>
<span><span class="co">#&gt;   ..$ type    : chr "regression"</span></span>
<span><span class="co">#&gt;   ..$ residual: int 26</span></span>
<span><span class="co">#&gt;   ..$ sigma2  : num 5.91</span></span>
<span><span class="co">#&gt;   ..$ is_glm  : num 0</span></span>
<span><span class="co">#&gt;  $ terms  :List of 6</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "parsed_model" "pm_regression" "list"</span></span></code></pre></div>
<p>Usually, we pass an R model object to functions such as:
<code><a href="../reference/tidypredict_fit.html">tidypredict_fit()</a></code>, and <code><a href="../reference/tidypredict_sql.html">tidypredict_sql()</a></code>.
These functions also accept a previously parsed model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></span>
<span><span class="co">#&gt; 53.5256637443325 + (wt * -6.38154597431605) + (disp * -0.0458426921825963) + </span></span>
<span><span class="co">#&gt;     (cyl * -3.63025567939439) + (wt * cyl * 0.535604359938273) + </span></span>
<span><span class="co">#&gt;     (disp * cyl * 0.00540618405824794)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="saving-the-model">Saving the model<a class="anchor" aria-label="anchor" href="#saving-the-model"></a>
</h2>
<p>Saving the model is quite easy, use the package such as
<code>yaml</code> to write the model object as a YAML file. Any format
that can persist a ragged list object should work as well.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vubiostat/r-yaml/" class="external-link">yaml</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/write_yaml.html" class="external-link">write_yaml</a></span><span class="op">(</span><span class="va">parsed</span>, <span class="st">"my_model.yml"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="re-load-the-model">Re-load the model<a class="anchor" aria-label="anchor" href="#re-load-the-model"></a>
</h2>
<p>In a new R session, we can read the YAML file into our
environment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidypredict.tidymodels.org">tidypredict</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vubiostat/r-yaml/" class="external-link">yaml</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">loaded_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"my_model"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loaded_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_parsed_model.html">as_parsed_model</a></span><span class="op">(</span><span class="va">loaded_model</span><span class="op">)</span></span></code></pre></div>
<p>The preview of the file looks exactly as the preview of the original
parsed model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">loaded_model</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ general:List of 6</span></span>
<span><span class="co">#&gt;   ..$ model   : chr "lm"</span></span>
<span><span class="co">#&gt;   ..$ version : num 2</span></span>
<span><span class="co">#&gt;   ..$ type    : chr "regression"</span></span>
<span><span class="co">#&gt;   ..$ residual: int 26</span></span>
<span><span class="co">#&gt;   ..$ sigma2  : num 5.91</span></span>
<span><span class="co">#&gt;   ..$ is_glm  : num 0</span></span>
<span><span class="co">#&gt;  $ terms  :List of 6</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;   ..$ :List of 5</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "parsed_model" "pm_regression" "list"</span></span></code></pre></div>
<p><code>tidypredict</code> is able to read the new R variable and use
it to create the formula.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">loaded_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; 53.5256637 + (wt * -6.381546) + (disp * -0.0458427) + (cyl * </span></span>
<span><span class="co">#&gt;     -3.6302557) + (wt * cyl * 0.5356044) + (disp * cyl * 0.0054062)</span></span></code></pre></div>
<p>The same variable can be used with other <code>tidypredict</code>
functions, such as <code><a href="../reference/tidypredict_sql.html">tidypredict_sql()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidypredict_sql.html">tidypredict_sql</a></span><span class="op">(</span><span class="va">loaded_model</span>, <span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/backend-odbc.html" class="external-link">simulate_odbc</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;SQL&gt; ((((53.5256637 + (`wt` * -6.381546)) + (`disp` * -0.0458427)) + (`cyl` * -3.6302557)) + ((`wt` * `cyl`) * 0.5356044)) + ((`disp` * `cyl`) * 0.0054062)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="broom">
<code>broom</code><a class="anchor" aria-label="anchor" href="#broom"></a>
</h2>
<p>The <code>parsed_model</code> object integrates with
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> from <code>broom</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">loaded_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   term        estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept) 53.5    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> wt          -<span style="color: #BB0000;">6.38</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> disp        -<span style="color: #BB0000;">0.045</span><span style="color: #BB0000; text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cyl         -<span style="color: #BB0000;">3.63</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> wt:cyl       0.536  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> disp:cyl     0.005<span style="text-decoration: underline;">41</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edgar Ruiz, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
