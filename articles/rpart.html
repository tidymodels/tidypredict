<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Decision trees, using rpart • tidypredict</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decision trees, using rpart">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="tidypredict.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidypredict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-list" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model list</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-list">
<li><a class="dropdown-item" href="../articles/lm.html">Linear Regression - lm()</a></li>
    <li><a class="dropdown-item" href="../articles/glm.html">Generalized Regression - glm()</a></li>
    <li><a class="dropdown-item" href="../articles/glmnet.html">Regularized Regression - glmnet()</a></li>
    <li><a class="dropdown-item" href="../articles/ranger.html">Random Forest - Ranger - ranger()</a></li>
    <li><a class="dropdown-item" href="../articles/rf.html">Random Forest - randomForest()</a></li>
    <li><a class="dropdown-item" href="../articles/rpart.html">Decision Tree - rpart()</a></li>
    <li><a class="dropdown-item" href="../articles/mars.html">MARS - earth()</a></li>
    <li><a class="dropdown-item" href="../articles/cubist.html">Cubist - cubist()</a></li>
    <li><a class="dropdown-item" href="../articles/xgboost.html">XGboost - xgb.Booster.complete()</a></li>
    <li><a class="dropdown-item" href="../articles/lightgbm.html">LightGBM - lgb.Booster()</a></li>
    <li><a class="dropdown-item" href="../articles/catboost.html">CatBoost - catboost.Model()</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/save.html">Save/Reload</a></li>
    <li><a class="dropdown-item" href="../articles/tree-internals.html">How tree formulas work</a></li>
    <li><a class="dropdown-item" href="../articles/float-precision.html">Float precision at split boundaries</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/non-r.html">Non-R models</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">Regression spec</a></li>
    <li><a class="dropdown-item" href="../articles/tree.html">Tree model spec</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/sql.html">DB Writeback</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tidypredict/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Decision trees, using rpart</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tidypredict/blob/main/vignettes/rpart.Rmd" class="external-link"><code>vignettes/rpart.Rmd</code></a></small>
      <div class="d-none name"><code>rpart.Rmd</code></div>
    </div>

    
    
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>Works</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code><a href="../reference/tidypredict_fit.html">tidypredict_fit()</a></code>, <code><a href="../reference/tidypredict_sql.html">tidypredict_sql()</a></code>,
<code><a href="../reference/parse_model.html">parse_model()</a></code>
</td>
<td></td>
</tr>
<tr class="even">
<td><code><a href="../reference/tidypredict_to_column.html">tidypredict_to_column()</a></code></td>
<td></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/tidypredict_test.html">tidypredict_test()</a></code></td>
<td></td>
</tr>
<tr class="even">
<td>
<code><a href="../reference/tidypredict_interval.html">tidypredict_interval()</a></code>,
<code><a href="../reference/tidypredict_sql_interval.html">tidypredict_sql_interval()</a></code>
</td>
<td></td>
</tr>
<tr class="odd">
<td><code>parsnip</code></td>
<td></td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h2>
<p>Here is a simple <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> model using the
<code>mtcars</code> dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidypredict.tidymodels.org">tidypredict</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>The parser extracts the tree structure from the model’s
<code>frame</code> and <code>splits</code> components. It handles both
numeric and categorical splits, as well as surrogate splits for missing
value handling.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">frame</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      var  n wt        dev     yval complexity ncompete nsurrogate</span></span>
<span><span class="co">#&gt; 1    cyl 32 32 1126.04719 20.09062 0.64312523        4          5</span></span>
<span><span class="co">#&gt; 2     hp 21 21  198.47238 16.64762 0.09748407        4          5</span></span>
<span><span class="co">#&gt; 4 &lt;leaf&gt;  7  7   28.82857 13.41429 0.01000000        0          0</span></span>
<span><span class="co">#&gt; 5 &lt;leaf&gt; 14 14   59.87214 18.26429 0.01000000        0          0</span></span>
<span><span class="co">#&gt; 3 &lt;leaf&gt; 11 11  203.38545 26.66364 0.01000000        0          0</span></span></code></pre></div>
<p>The output from <code><a href="../reference/parse_model.html">parse_model()</a></code> is transformed into a
<code>dplyr</code>, a.k.a Tidy Eval, formula. The decision tree becomes
a <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">dplyr::case_when()</a></code> statement.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; case_when(cyl &lt;= 5 ~ 26.6636363636364, .default = case_when(hp &lt;= </span></span>
<span><span class="co">#&gt;     192.5 ~ 18.2642857142857, .default = 13.4142857142857))</span></span></code></pre></div>
<p>From there, the Tidy Eval formula can be used anywhere where it can
be operated. <code>tidypredict</code> provides three paths:</p>
<ul>
<li>Use directly inside <code>dplyr</code>,
<code>mutate(mtcars, !! tidypredict_fit(model))</code>
</li>
<li>Use <code>tidypredict_to_column(model)</code> to a piped command
set</li>
<li>Use <code>tidypredict_to_sql(model)</code> to retrieve the SQL
statement</li>
</ul>
</div>
<div class="section level2">
<h2 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h2>
<p><code>rpart</code> classification models are also supported:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">model_class</span><span class="op">)</span></span>
<span><span class="co">#&gt; case_when(Petal.Length &lt;= 2.45 ~ "setosa", .default = case_when(Petal.Width &lt;= </span></span>
<span><span class="co">#&gt;     1.75 ~ "versicolor", .default = "virginica"))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parsnip">parsnip<a class="anchor" aria-label="anchor" href="#parsnip"></a>
</h2>
<p><code>tidypredict</code> also supports <code>rpart</code> model
objects fitted via the <code>parsnip</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">parsnip_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">parsnip_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; case_when(cyl &lt;= 5 ~ 26.6636363636364, .default = case_when(hp &lt;= </span></span>
<span><span class="co">#&gt;     192.5 ~ 18.2642857142857, .default = 13.4142857142857))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="categorical-predictors">Categorical predictors<a class="anchor" aria-label="anchor" href="#categorical-predictors"></a>
</h2>
<p><code>rpart</code> handles categorical predictors natively. The
generated formula uses <code>%in%</code> for categorical splits:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars2</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mtcars2</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars2</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span><span class="op">(</span><span class="va">model_cat</span><span class="op">)</span></span>
<span><span class="co">#&gt; case_when(cyl %in% c("6", "8") ~ case_when(hp &lt;= 192.5 ~ 18.2642857142857, </span></span>
<span><span class="co">#&gt;     .default = 13.4142857142857), .default = 26.6636363636364)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="surrogate-splits">Surrogate splits<a class="anchor" aria-label="anchor" href="#surrogate-splits"></a>
</h2>
<p><code>rpart</code> uses surrogate splits to handle missing values
during prediction. When the primary split variable is missing, the model
uses surrogate variables (other variables that produce similar splits)
to route the observation. This behavior is controlled by the
<code>usesurrogate</code> parameter in <code><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html" class="external-link">rpart.control()</a></code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, Edgar Ruiz, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
