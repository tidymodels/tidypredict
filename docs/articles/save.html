<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Save and re-load models • tidypredict</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Save and re-load models">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidypredict</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/glm.html">Generalized Linear Regression</a>
    </li>
    <li>
      <a href="../articles/lm.html">Linear Regression</a>
    </li>
    <li>
      <a href="../articles/rf.html">Random Forest</a>
    </li>
    <li>
      <a href="../articles/save.html">Save and re-load models</a>
    </li>
    <li>
      <a href="../articles/sql.html">Database write-back</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Save and re-load models</h1>
            
      
      
      <div class="hidden name"><code>save.Rmd</code></div>

    </div>

    
    
<p><code>tidypredict</code> splits the translation process in two. It first parses the model to extract the needed components to produce the prediction. And second, it uses the object with the prased information to produce the R formula. Thanks to this two step process, <code>tidypredict</code> does not need to parse the model every time. <code>tidypredict</code>’s functions also accept R objects that contained already models that have been parsed already. Additionally, because the parsed model object is made up of a list made up of basic variables, it is possible to save it in a file. Currently, the best file format is YAML.</p>
<p>For this article, we will use the following model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(mpg <span class="op">~</span><span class="st"> </span>(wt <span class="op">+</span><span class="st"> </span>disp) <span class="op">*</span><span class="st"> </span>cyl, <span class="dt">data =</span> mtcars)</a></code></pre></div>
<div id="parse-model" class="section level2">
<h2 class="hasAnchor">
<a href="#parse-model" class="anchor"></a>Parse model</h2>
<p>The <code><a href="../reference/parse_model.html">parse_model()</a></code> function allows to run the first step manually. It will return an R list object which contains all of the needed information to produce a prediction calculation. The structure of the parsed model varies based on what kind of model is being processed. In general, it is consistent in what kind of information it expects from each model type. For example, in the example the <code><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm()</a></code> model object will return variables such as <code>sigma2</code>, which would not be used in other model types, such as decision trees.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidypredict)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">parsed &lt;-<span class="st"> </span><span class="kw"><a href="../reference/parse_model.html">parse_model</a></span>(model)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(parsed, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;  $ general:List of 6</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;   ..$ model   : chr "lm"</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;   ..$ version : num 2</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;   ..$ type    : chr "regression"</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;   ..$ residual: int 26</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;   ..$ sigma2  : num 5.91</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;   ..$ is_glm  : num 0</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;  $ terms  :List of 6</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;   ..$ :List of 5</span></a></code></pre></div>
<p>Usually, we pass an R model object to functions such as: <code><a href="../reference/tidypredict_fit.html">tidypredict_fit()</a></code>, and <code><a href="../reference/tidypredict_sql.html">tidypredict_sql()</a></code>. These functions also accept a previously parsed model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span>(parsed)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; 53.5256637443325 + (wt * -6.38154597431604) + (disp * -0.0458426921825966) + </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;     (cyl * -3.6302556793944) + (wt * cyl * 0.535604359938273) + </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;     (disp * cyl * 0.00540618405824797)</span></a></code></pre></div>
</div>
<div id="saving-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-the-model" class="anchor"></a>Saving the model</h2>
<p>Saving the model is quite easy, use the package such as <code>yaml</code> to write the model object as a YAML file. Any format that can persist a ragged list object should work as well.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(yaml)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/yaml/topics/write_yaml">write_yaml</a></span>(parsed, <span class="st">"my_model.yml"</span>)</a></code></pre></div>
</div>
<div id="re-load-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#re-load-the-model" class="anchor"></a>Re-load the model</h2>
<p>In a new R session, we can read the YAML file into our envrironment.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidypredict)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(yaml)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">loaded_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/yaml/topics/read_yaml">read_yaml</a></span>(<span class="st">"my_model"</span>)</a></code></pre></div>
<p>The preview of the file looks exactly as the preview of the original parsed model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(loaded_model, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;  $ general:List of 6</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;   ..$ model   : chr "lm"</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;   ..$ version : num 2</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;   ..$ type    : chr "regression"</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;   ..$ residual: int 26</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;   ..$ sigma2  : num 5.91</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   ..$ is_glm  : num 0</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;  $ terms  :List of 6</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;   ..$ :List of 5</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;   ..$ :List of 5</span></a></code></pre></div>
<p><code>tidypredict</code> is able to read the new R variable and use it to create the formula.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/tidypredict_fit.html">tidypredict_fit</a></span>(loaded_model)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; 53.5256637 + (wt * -6.381546) + (disp * -0.0458427) + (cyl * </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;     -3.6302557) + (wt * cyl * 0.5356044) + (disp * cyl * 0.0054062)</span></a></code></pre></div>
<p>The same variable can be used with other <code>tidypredict</code> functions, such as <code><a href="../reference/tidypredict_sql.html">tidypredict_sql()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/tidypredict_sql.html">tidypredict_sql</a></span>(loaded_model, dbplyr<span class="op">::</span><span class="kw"><a href="https://dbplyr.tidyverse.org/reference/simulate_dbi.html">simulate_odbc</a></span>())</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; &lt;SQL&gt; 53.5256637 + (`wt` * -6.381546) + (`disp` * -0.0458427) + (`cyl` * -3.6302557) + (`wt` * `cyl` * 0.5356044) + (`disp` * `cyl` * 0.0054062)</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#parse-model">Parse model</a></li>
      <li><a href="#saving-the-model">Saving the model</a></li>
      <li><a href="#re-load-the-model">Re-load the model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edgar Ruiz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
